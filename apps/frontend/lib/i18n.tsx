"use client"

import { createContext, useContext, useMemo, type ReactNode } from "react"

import { UI_LANGUAGE_OPTIONS, useChatSettings } from "@/lib/mode"

const EN_MESSAGES = {
  "chat.title": "YouWorker.AI",
  "chat.empty.title": "Start a conversation",
  "chat.empty.description": "Ask a question or ingest a document to begin working together.",
  "chat.status.analyzing": "Analyzing your request to craft the best answer…",
  "chat.actions.copy": "Copy message",
  "chat.actions.more": "More actions",
  "chat.actions.copied": "Message copied to clipboard",
  "chat.actions.regenerate": "Regenerate reply",
  "chat.actions.edit": "Edit message",
  "chat.actions.error.no_user": "Unable to regenerate because no user prompt was found.",
  "chat.actions.error.clipboard": "Copy failed. Please copy manually.",
  "chat.error.busy": "A response is already running. Please wait for it to finish.",
  "chat.error.streaming": "Unable to start streaming the response.",
  "chat.actions.editing": "Editing previous message…",
  "chat.actions.cancel_edit": "Cancel edit",
  "chat.message.user": "User message",
  "chat.message.assistant": "Assistant message",
  "chat.placeholder.examples": "Try asking for a summary, an email draft or an analysis.",
  "chat.actions.hold_to_talk": "Hold to talk",
  "chat.actions.release_to_stop": "Release to stop",
  "chat.actions.stop": "Stop",
  "chat.actions.send": "Send",
  "composer.placeholder": "Type your message or use voice input…",
  "composer.voice.recording": "Listening… release to stop",
  "composer.voice.waiting": "Wait for the current reply to finish",
  "composer.voice.ready": "Hold the mic button and speak",
  "composer.voice.playing": "Playing audio response…",
  "composer.voice.error": "Voice request failed. Please try again.",
  "composer.voice.unavailable": "Voice input is not available right now.",
  "composer.voice.start_error": "Unable to start recording. Please try again.",
  "composer.voice.stop_error": "Error while stopping the recording.",
  "composer.voice.no_audio": "No audio recorded. Please try again.",
  "composer.processing": "Processing your request…",
  "composer.audio.enabled": "Audio reply enabled",
  "composer.audio.disabled": "Text-only reply",
  "error.boundary.title": "Something went wrong",
  "error.boundary.description": "An unexpected error occurred. Try again or reload the page.",
  "error.boundary.retry": "Try again",
  "history.empty.sessions.title": "No conversations yet",
  "history.empty.sessions.description": "Your recent conversations will appear here once you start chatting.",
  "history.empty.documents.title": "No documents ingested",
  "history.empty.documents.description": "Upload a file or URL from the Ingest page and it will show up here.",
  "history.empty.ingestion.title": "No ingestion runs",
  "history.empty.ingestion.description": "Track the ingestion history of your files and web sources in this section.",
  "history.title": "History",
  "history.subtitle": "Manage conversations, documents, and ingestion runs",
  "history.button.back": "Back to chat",
  "history.button.refresh": "Refresh",
  "history.tabs.sessions": "Sessions",
  "history.tabs.documents": "Documents",
  "history.tabs.ingestion": "Ingestions",
  "history.sessions.count": "{{count}} conversations",
  "history.documents.count": "{{count}} documents",
  "history.ingestion.count": "{{count}} ingestion runs",
  "nav.chat": "Chat",
  "nav.history": "History",
  "nav.analytics": "Analytics",
  "nav.settings": "Settings",
  "nav.ingest": "Ingest",
  "nav.new_chat": "New chat",
  "nav.upload": "Upload file",
  "nav.api_status.online": "API Online",
  "nav.api_status.offline": "API Offline",
  "mobile.nav.chat": "Chat",
  "mobile.nav.ingest": "Ingest",
  "mobile.nav.history": "History",
  "mobile.nav.analytics": "Analytics",
  "mobile.nav.settings": "Settings",
  "analytics.header.description": "Monitor your AI assistant's performance and usage.",
  "analytics.time_range.label": "Select time range",
  "analytics.time_range.placeholder": "Select time range",
  "analytics.time_range.last_7": "Last 7 days",
  "analytics.time_range.last_30": "Last 30 days",
  "analytics.time_range.last_90": "Last 90 days",
  "analytics.time_range.last_365": "Last year",
  "analytics.overview.sessions.title": "Total Sessions",
  "analytics.overview.sessions.description": "{{value}} avg per day",
  "analytics.overview.tokens.title": "Total Tokens",
  "analytics.overview.tokens.description": "{{value}} avg per message",
  "analytics.overview.tools.title": "Tool Success Rate",
  "analytics.overview.tools.description": "{{value}} total runs",
  "analytics.overview.documents.title": "Documents",
  "analytics.overview.documents.description": "{{value}} ingestion runs",
  "analytics.tabs.tokens": "Token Usage",
  "analytics.tabs.tools": "Tool Performance",
  "analytics.tabs.ingestion": "Ingestion",
  "analytics.tabs.sessions": "Sessions",
  "analytics.tokens.chart.title": "Token Usage Over Time",
  "analytics.tokens.chart.description": "Track your token consumption trends.",
  "analytics.tokens.chart.series_input": "Input Tokens",
  "analytics.tokens.chart.series_output": "Output Tokens",
  "analytics.tokens.tooltip.input": "Input",
  "analytics.tokens.tooltip.output": "Output",
  "analytics.tools.success.title": "Tool Success Rates",
  "analytics.tools.success.description": "Performance by tool",
  "analytics.tools.latency.title": "Tool Latency",
  "analytics.tools.latency.description": "Average execution time (ms)",
  "analytics.tools.chart.success_rate": "Success Rate %",
  "analytics.tools.chart.avg_latency": "Avg Latency (ms)",
  "analytics.tools.table.title": "Detailed Tool Statistics",
  "analytics.tools.table.tool": "Tool",
  "analytics.tools.table.total_runs": "Total Runs",
  "analytics.tools.table.success_rate": "Success Rate",
  "analytics.tools.table.avg_latency": "Avg Latency",
  "analytics.tools.table.min_max": "Min/Max",
  "analytics.ingestion.timeline.title": "Ingestion Timeline",
  "analytics.ingestion.timeline.description": "Files and chunks processed over time",
  "analytics.ingestion.timeline.series_files": "Files",
  "analytics.ingestion.timeline.series_chunks": "Chunks",
  "analytics.ingestion.collections.title": "Documents by Collection",
  "analytics.ingestion.collections.description": "Distribution of documents",
  "analytics.ingestion.collections.label": "{{collection}} ({{count}} documents)",
  "analytics.ingestion.table.title": "Collection Statistics",
  "analytics.ingestion.table.collection": "Collection",
  "analytics.ingestion.table.documents": "Documents",
  "analytics.ingestion.table.size": "Total Size",
  "analytics.sessions.activity.title": "Session Activity",
  "analytics.sessions.activity.description": "Daily session creation",
  "analytics.sessions.activity.series_sessions": "Sessions",
  "analytics.sessions.activity.series_with_tools": "With Tools",
  "analytics.sessions.model.title": "Model Usage",
  "analytics.sessions.model.description": "Sessions by model",
  "analytics.sessions.model.label": "{{model}} ({{count}} sessions)",
  "settings.language.interface": "Interface language",
  "settings.language.assistant": "Assistant language",
  "settings.language.interface_description": "Select the language used for the interface and UI labels.",
  "settings.language.assistant_description": "Choose the default language for assistant replies.",
  "settings.language.placeholder": "Select language",
  "settings.quick_title": "Quick settings",
  "settings.quick_description": "Manage the interface and essential tools for your workspace.",
  "settings.workspace": "Workspace",
  "settings.workspace.theme": "Theme",
  "settings.workspace.theme_hint": "Switch between light, dark or system mode.",
  "settings.workspace.theme_note": "The selected theme is saved and applied to active sessions.",
  "settings.history": "History",
  "settings.history.description": "Review recent conversations and documents without leaving this view.",
  "settings.history.open": "Open history",
  "settings.accessibility": "Accessibility",
  "settings.accessibility.description": "Animations follow your system preferences automatically.",
  "toast.copied": "Copied to clipboard",
  "toast.regenerating": "Regenerating reply…",
  "history.toast.session_deleted": "Conversation deleted",
  "history.toast.document_deleted": "Document deleted",
  "history.toast.ingestion_deleted": "Ingestion run deleted",
  "history.toast.delete_failed": "Deletion failed",
  "history.error.load_sessions": "Unable to load sessions",
  "history.error.load_documents": "Unable to load documents",
  "history.error.load_ingestion": "Unable to load ingestion runs",
  "history.table.title": "Title",
  "history.table.model": "Model",
  "history.table.type": "Type",
  "history.table.type_web": "Web",
  "history.table.type_file": "File",
  "history.table.source": "Source",
  "history.table.ingested": "Ingested",
  "history.table.created": "Created",
  "history.table.updated": "Updated",
  "history.table.actions": "Actions",
  "history.table.status": "Status",
  "history.table.size": "Size",
  "history.table.tags": "Tags",
  "history.table.files": "Files",
  "history.table.chunks": "Chunks",
  "history.table.not_available": "N/A",
  "history.table.unknown": "Unknown",
  "history.table.untitled": "Untitled",
  "history.status.success": "Success",
  "history.status.partial": "Partial",
  "history.status.error": "Error",
  "history.action.delete": "Delete",
  "history.action.open": "Open",
  "history.dialog.delete_title": "Delete item",
  "history.dialog.delete_description": "This operation cannot be undone.",
  "history.dialog.delete_body": "Are you sure you want to delete \"{{name}}\"? This action cannot be undone.",
  "history.dialog.cancel": "Cancel",
  "history.dialog.confirm": "Delete",
  "history.placeholder.search": "Search conversations...",
  "history.empty.search_results": "No conversations found",
  "common.close": "Close",
  "tool.status.running": "Running",
  "tool.status.success": "Completed",
  "tool.status.error": "Error",
  "tool.status.cached": "Cached",
  "tool.update.start": "Started",
  "tool.update.end": "Completed",
  "tool.update.error": "Error",
  "tool.update.cached": "Cached",
  "tool.history.title": "Tool History",
  "tool.empty.events": "No tool events",
  "tool.metadata.title": "Response Metadata",
  "ingest.title": "Upload and Process Files",
  "ingest.description": "Add local paths or URLs to enrich the workspace before discussing with the assistant.",
  "ingest.upload_files": "Upload files",
  "ingest.web_url": "Web URL",
  "ingest.files_added": "files added",
  "ingest.files_selected": "files selected",
  "ingest.error.select_file": "Select at least one file",
  "ingest.error.url_required": "URL required",
  "ingest.success.completed": "Ingestion completed",
  "ingest.warning.completed_with_errors": "Completed with",
  "ingest.error.failed": "Ingestion failed",
  "ingest.files": "files",
  "ingest.chunks": "chunks",
  "ingest.error": "error",
  "ingest.errors": "errors",
  "ingest.drop_files_here": "Drop files here",
  "ingest.drag_or_click": "Drag files here or click to select",
  "ingest.supported_formats": "Supports all common formats (PDF, DOC, images, audio, video)",
  "ingest.remove_all": "Remove all",
  "ingest.remove_file": "Remove file",
  "ingest.url_placeholder": "https://example.com/document",
  "ingest.url_description": "Download and analyze the specified web page, extracting text, images and tables.",
  "ingest.tags_label": "Tags",
  "ingest.tags_separator": "separated by commas",
  "ingest.tags_placeholder": "documentation, api, reference",
  "ingest.uploading": "Uploading...",
  "ingest.analyzing": "Analyzing URL...",
  "ingest.upload_and_index": "Upload and index",
  "ingest.analyze_url": "Analyze URL",
  "ingest.upload_and_process": "Upload and processing",
  "ingest.success.title": "Ingestion completed successfully!",
  "ingest.success.description": "Documents are now available for search and analysis",
  "ingest.files_processed": "Files processed",
  "ingest.chunks_created": "Chunks created",
  "ingest.total_size": "Total size",
  "ingest.table.path": "Path",
  "ingest.table.type": "Type",
  "ingest.table.chunks": "Chunks",
  "ingest.table.size": "Size",
  "ingest.start_chat": "Start a chat about these documents"
} as const

const IT_MESSAGES: typeof EN_MESSAGES = {
  "chat.title": "YouWorker.AI",
  "chat.empty.title": "Inizia una conversazione",
  "chat.empty.description": "Fai una domanda o ingerisci un documento per iniziare a lavorare insieme.",
  "chat.status.analyzing": "Sto analizzando le informazioni per offrirti la risposta migliore…",
  "chat.actions.copy": "Copia messaggio",
  "chat.actions.more": "Azioni disponibili",
  "chat.actions.copied": "Messaggio copiato negli appunti",
  "chat.actions.regenerate": "Rigenera risposta",
  "chat.actions.edit": "Modifica messaggio",
  "chat.actions.error.no_user": "Impossibile rigenerare: nessun messaggio utente trovato.",
  "chat.actions.error.clipboard": "Copia non riuscita. Copia manualmente il testo.",
  "chat.error.busy": "Una risposta è già in corso. Attendi il completamento.",
  "chat.error.streaming": "Impossibile avviare lo streaming della risposta.",
  "chat.actions.editing": "Modifica del messaggio in corso…",
  "chat.actions.cancel_edit": "Annulla modifica",
  "chat.message.user": "Messaggio utente",
  "chat.message.assistant": "Messaggio assistente",
  "chat.placeholder.examples": "Prova a chiedere un riassunto, una email o un'analisi.",
  "chat.actions.hold_to_talk": "Tieni premuto per parlare",
  "chat.actions.release_to_stop": "Rilascia per fermare",
  "chat.actions.stop": "Interrompi",
  "chat.actions.send": "Invia",
  "composer.placeholder": "Scrivi il tuo messaggio o usa il pulsante vocale…",
  "composer.voice.recording": "Ascolto... rilascia per fermare",
  "composer.voice.waiting": "Attendi il completamento della risposta",
  "composer.voice.ready": "Tieni premuto il pulsante microfono e parla",
  "composer.voice.playing": "Riproduzione risposta audio...",
  "composer.voice.error": "Richiesta vocale non riuscita. Riprova.",
  "composer.voice.unavailable": "Input vocale non disponibile",
  "composer.voice.start_error": "Impossibile avviare la registrazione. Riprova.",
  "composer.voice.stop_error": "Errore durante la chiusura della registrazione.",
  "composer.voice.no_audio": "Nessun audio registrato. Riprova.",
  "composer.processing": "Elaborazione della richiesta...",
  "composer.audio.enabled": "Risposta con audio",
  "composer.audio.disabled": "Risposta solo testo",
  "error.boundary.title": "Qualcosa è andato storto",
  "error.boundary.description": "Si è verificato un errore imprevisto. Riprova o ricarica la pagina.",
  "error.boundary.retry": "Riprova",
  "history.empty.sessions.title": "Ancora nessuna conversazione",
  "history.empty.sessions.description": "Le conversazioni recenti appariranno qui appena inizi a chattare.",
  "history.empty.documents.title": "Nessun documento ingerito",
  "history.empty.documents.description": "Carica un file o un URL dalla pagina Ingest per vederlo in questo elenco.",
  "history.empty.ingestion.title": "Nessuna ingestione registrata",
  "history.empty.ingestion.description": "Tieni traccia qui delle operazioni di ingestione dei tuoi file e delle fonti web.",
  "history.title": "Cronologia",
  "history.subtitle": "Gestisci conversazioni, documenti e operazioni di ingestione",
  "history.button.back": "Torna alla chat",
  "history.button.refresh": "Aggiorna",
  "history.tabs.sessions": "Sessioni",
  "history.tabs.documents": "Documenti",
  "history.tabs.ingestion": "Ingestioni",
  "history.sessions.count": "{{count}} sessioni",
  "history.documents.count": "{{count}} documenti",
  "history.ingestion.count": "{{count}} ingestion registrate",
  "nav.chat": "Chat",
  "nav.history": "Cronologia",
  "nav.analytics": "Analisi",
  "nav.settings": "Impostazioni",
  "nav.ingest": "Ingest",
  "nav.new_chat": "Nuova chat",
  "nav.upload": "Carica file",
  "nav.api_status.online": "API Online",
  "nav.api_status.offline": "API Offline",
  "mobile.nav.chat": "Chat",
  "mobile.nav.ingest": "Ingest",
  "mobile.nav.history": "Cronologia",
  "mobile.nav.analytics": "Analisi",
  "mobile.nav.settings": "Impostazioni",
  "analytics.header.description": "Monitora le prestazioni e l'utilizzo del tuo assistente AI.",
  "analytics.time_range.label": "Seleziona intervallo temporale",
  "analytics.time_range.placeholder": "Seleziona intervallo temporale",
  "analytics.time_range.last_7": "Ultimi 7 giorni",
  "analytics.time_range.last_30": "Ultimi 30 giorni",
  "analytics.time_range.last_90": "Ultimi 90 giorni",
  "analytics.time_range.last_365": "Ultimo anno",
  "analytics.overview.sessions.title": "Sessioni totali",
  "analytics.overview.sessions.description": "{{value}} in media al giorno",
  "analytics.overview.tokens.title": "Token totali",
  "analytics.overview.tokens.description": "{{value}} in media per messaggio",
  "analytics.overview.tools.title": "Tasso di successo strumenti",
  "analytics.overview.tools.description": "{{value}} esecuzioni totali",
  "analytics.overview.documents.title": "Documenti",
  "analytics.overview.documents.description": "{{value}} operazioni di ingestione",
  "analytics.tabs.tokens": "Utilizzo token",
  "analytics.tabs.tools": "Prestazioni strumenti",
  "analytics.tabs.ingestion": "Ingestione",
  "analytics.tabs.sessions": "Sessioni",
  "analytics.tokens.chart.title": "Utilizzo token nel tempo",
  "analytics.tokens.chart.description": "Monitora l'andamento del consumo di token.",
  "analytics.tokens.chart.series_input": "Token in ingresso",
  "analytics.tokens.chart.series_output": "Token in uscita",
  "analytics.tokens.tooltip.input": "Input",
  "analytics.tokens.tooltip.output": "Output",
  "analytics.tools.success.title": "Tassi di successo strumenti",
  "analytics.tools.success.description": "Prestazioni per strumento",
  "analytics.tools.latency.title": "Latenza degli strumenti",
  "analytics.tools.latency.description": "Tempo medio di esecuzione (ms)",
  "analytics.tools.chart.success_rate": "Percentuale di successo",
  "analytics.tools.chart.avg_latency": "Latenza media (ms)",
  "analytics.tools.table.title": "Statistiche dettagliate degli strumenti",
  "analytics.tools.table.tool": "Strumento",
  "analytics.tools.table.total_runs": "Esecuzioni totali",
  "analytics.tools.table.success_rate": "Percentuale di successo",
  "analytics.tools.table.avg_latency": "Latenza media",
  "analytics.tools.table.min_max": "Min/Max",
  "analytics.ingestion.timeline.title": "Cronologia ingestione",
  "analytics.ingestion.timeline.description": "File e chunk elaborati nel tempo",
  "analytics.ingestion.timeline.series_files": "File",
  "analytics.ingestion.timeline.series_chunks": "Blocchi",
  "analytics.ingestion.collections.title": "Documenti per raccolta",
  "analytics.ingestion.collections.description": "Distribuzione dei documenti",
  "analytics.ingestion.collections.label": "{{collection}} ({{count}} documenti)",
  "analytics.ingestion.table.title": "Statistiche delle raccolte",
  "analytics.ingestion.table.collection": "Raccolta",
  "analytics.ingestion.table.documents": "Documenti",
  "analytics.ingestion.table.size": "Dimensione totale",
  "analytics.sessions.activity.title": "Attività delle sessioni",
  "analytics.sessions.activity.description": "Creazione giornaliera di sessioni",
  "analytics.sessions.activity.series_sessions": "Sessioni",
  "analytics.sessions.activity.series_with_tools": "Con strumenti",
  "analytics.sessions.model.title": "Utilizzo dei modelli",
  "analytics.sessions.model.description": "Sessioni per modello",
  "analytics.sessions.model.label": "{{model}} ({{count}} sessioni)",
  "settings.language.interface": "Lingua interfaccia",
  "settings.language.assistant": "Lingua assistente",
  "settings.language.interface_description": "Seleziona la lingua usata per l'interfaccia e le etichette.",
  "settings.language.assistant_description": "Scegli la lingua predefinita delle risposte generate.",
  "settings.language.placeholder": "Seleziona lingua",
  "settings.quick_title": "Impostazioni rapide",
  "settings.quick_description": "Gestisci interfaccia e strumenti essenziali della workspace.",
  "settings.workspace": "Workspace",
  "settings.workspace.theme": "Tema",
  "settings.workspace.theme_hint": "Passa rapidamente tra modalità chiara, scura o automatica.",
  "settings.workspace.theme_note": "Il tema selezionato viene salvato e applicato a tutte le sessioni attive.",
  "settings.history": "Cronologia",
  "settings.history.description": "Consulta conversazioni e documenti inviati di recente senza lasciare questa finestra.",
  "settings.history.open": "Apri cronologia",
  "settings.accessibility": "Accessibilità",
  "settings.accessibility.description": "Adattiamo automaticamente animazioni e riduzione del movimento alle preferenze di sistema.",
  "toast.copied": "Copiato negli appunti",
  "toast.regenerating": "Rigenerazione in corso…",
  "history.toast.session_deleted": "Sessione eliminata",
  "history.toast.document_deleted": "Documento eliminato",
  "history.toast.ingestion_deleted": "Ingestione eliminata",
  "history.toast.delete_failed": "Eliminazione non riuscita",
  "history.error.load_sessions": "Impossibile caricare le sessioni",
  "history.error.load_documents": "Impossibile caricare i documenti",
  "history.error.load_ingestion": "Impossibile caricare le operazioni di ingestione",
  "history.table.title": "Titolo",
  "history.table.model": "Modello",
  "history.table.type": "Tipo",
  "history.table.type_web": "Web",
  "history.table.type_file": "File",
  "history.table.source": "Sorgente",
  "history.table.ingested": "Data ingestione",
  "history.table.created": "Creata",
  "history.table.updated": "Aggiornata",
  "history.table.actions": "Azioni",
  "history.table.status": "Stato",
  "history.table.size": "Dimensione",
  "history.table.tags": "Tag",
  "history.table.files": "File",
  "history.table.chunks": "Chunk",
  "history.table.not_available": "N/D",
  "history.table.unknown": "Sconosciuto",
  "history.table.untitled": "Senza titolo",
  "history.status.success": "Successo",
  "history.status.partial": "Parziale",
  "history.status.error": "Errore",
  "history.action.delete": "Elimina",
  "history.action.open": "Apri",
  "history.dialog.delete_title": "Elimina elemento",
  "history.dialog.delete_description": "Questa operazione non può essere annullata.",
  "history.dialog.delete_body": "Sei sicuro di voler eliminare \"{{name}}\"? Questa azione è irreversibile.",
  "history.dialog.cancel": "Annulla",
  "history.dialog.confirm": "Elimina",
  "history.placeholder.search": "Cerca conversazioni...",
  "history.empty.search_results": "Nessuna conversazione trovata",
  "common.close": "Chiudi",
  "tool.status.running": "In esecuzione",
  "tool.status.success": "Completato",
  "tool.status.error": "Errore",
  "tool.status.cached": "Cache",
  "tool.update.start": "Avviato",
  "tool.update.end": "Completato",
  "tool.update.error": "Errore",
  "tool.update.cached": "Cache",
  "tool.history.title": "Cronologia strumenti",
  "tool.empty.events": "Nessun evento strumento",
  "tool.metadata.title": "Metadati della risposta",
  "ingest.title": "Caricamento ed elaborazione file",
  "ingest.description": "Aggiungi percorsi locali o URL per arricchire il workspace prima di parlarne con l'assistente.",
  "ingest.upload_files": "Carica file",
  "ingest.web_url": "URL web",
  "ingest.files_added": "file aggiunti",
  "ingest.files_selected": "file selezionati",
  "ingest.error.select_file": "Seleziona almeno un file",
  "ingest.error.url_required": "URL obbligatorio",
  "ingest.success.completed": "Ingestione completata",
  "ingest.warning.completed_with_errors": "Completata con",
  "ingest.error.failed": "Ingestione non riuscita",
  "ingest.files": "file",
  "ingest.chunks": "chunk",
  "ingest.error": "errore",
  "ingest.errors": "errori",
  "ingest.drop_files_here": "Rilascia i file qui",
  "ingest.drag_or_click": "Trascina i file qui o clicca per selezionare",
  "ingest.supported_formats": "Supporta tutti i formati comuni (PDF, DOC, immagini, audio, video)",
  "ingest.remove_all": "Rimuovi tutti",
  "ingest.remove_file": "Rimuovi file",
  "ingest.url_placeholder": "https://example.com/documento",
  "ingest.url_description": "Scarica e analizza la pagina web indicata, estraendo testo, immagini e tabelle.",
  "ingest.tags_label": "Tag",
  "ingest.tags_separator": "separati da virgola",
  "ingest.tags_placeholder": "documentazione, api, riferimento",
  "ingest.uploading": "Caricamento in corso...",
  "ingest.analyzing": "Analisi URL in corso...",
  "ingest.upload_and_index": "Carica e indicizza",
  "ingest.analyze_url": "Analizza URL",
  "ingest.upload_and_process": "Caricamento ed elaborazione",
  "ingest.success.title": "Ingestione completata con successo!",
  "ingest.success.description": "I documenti sono ora disponibili per la ricerca e l'analisi",
  "ingest.files_processed": "File processati",
  "ingest.chunks_created": "Chunk creati",
  "ingest.total_size": "Dimensione totale",
  "ingest.table.path": "Percorso",
  "ingest.table.type": "Tipo",
  "ingest.table.chunks": "Chunk",
  "ingest.table.size": "Dimensione",
  "ingest.start_chat": "Avvia una chat su questi documenti"
}

const TRANSLATIONS = {
  en: EN_MESSAGES,
  it: IT_MESSAGES,
} as const

type SupportedLanguage = keyof typeof TRANSLATIONS
type TranslationKey = keyof typeof EN_MESSAGES

interface I18nContextValue {
  language: SupportedLanguage
  setLanguage: (language: SupportedLanguage) => void
  t: (key: TranslationKey, params?: Record<string, string | number>, fallback?: string) => string
  availableLanguages: typeof UI_LANGUAGE_OPTIONS
}

const I18nContext = createContext<I18nContextValue | undefined>(undefined)

function formatMessage(template: string, params?: Record<string, string | number>) {
  if (!params) return template
  return template.replace(/\{\{(.*?)\}\}/g, (_, token: string) => {
    const value = params[token.trim()]
    return value === undefined ? `{{${token}}}` : String(value)
  })
}

export function I18nProvider({ children }: { children: ReactNode }) {
  const { uiLanguage, setUiLanguage } = useChatSettings()

  const value = useMemo<I18nContextValue>(() => {
    const lang: SupportedLanguage = (uiLanguage as SupportedLanguage) in TRANSLATIONS ? (uiLanguage as SupportedLanguage) : "en"

    const translate = (key: TranslationKey, params?: Record<string, string | number>, fallback?: string) => {
      const message = TRANSLATIONS[lang][key] ?? TRANSLATIONS.en[key] ?? fallback ?? key
      return formatMessage(message, params)
    }

    return {
      language: lang,
      setLanguage: (next) => setUiLanguage(next),
      t: translate,
      availableLanguages: UI_LANGUAGE_OPTIONS,
    }
  }, [uiLanguage, setUiLanguage])

  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>
}

export function useI18n() {
  const ctx = useContext(I18nContext)
  if (!ctx) {
    throw new Error("useI18n must be used within an I18nProvider")
  }
  return ctx
}

export type { TranslationKey }
